<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
	<meta name="viewport" content="user-scalable=no, initial-scale=1">

  <style>
			body {
				margin: 0px;
				background-color: #000000;
				overflow: hidden;
			}
  </style>
</head>
<body>
  test

  <div id="container"></div>


  <script src="js/three.min.js"></script>
  <script src="js/stats.min.js"></script>
  <script src="js/DeviceOrientationControls.js"></script>

  <script>
    (function() {
        "use strict";

        var stats = new Stats();
        stats.showPanel( 0 ); // 0: fps, 1: ms, 2: mb, 3+: custom
        // var xPanel = stats.addPanel( new Stats.Panel( 'x', '#ff8', '#221' ) );
        // var yPanel = stats.addPanel( new Stats.Panel( 'y', '#f8f', '#212' ) );
        // stats.showPanel( 3 );
        document.body.appendChild( stats.dom );

    	window.addEventListener('load', function() {

            var container, camera, scene, renderer, controls, geometry, mesh, dirLight, hemiLight;
            var t = 0;



            container = document.getElementById( 'container' );

            // camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
            // camera = new THREE.OrthographicCamera( window.innerWidth / - 2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / - 2, 1, 1000 );

            var rapportHL, cameraWidth;
            cameraWidth = 175;
            cameraWidth += window.innerWidth;
            cameraWidth /= 3;
            rapportHL = window.innerHeight/window.innerWidth;
            // camera = new THREE.OrthographicCamera( -cameraWidth, cameraWidth, cameraWidth*rapportHL, -cameraWidth*rapportHL     , -500, 1500 );
            camera = new THREE.PerspectiveCamera(48, window.innerWidth / window.innerHeight, 1, 1000);


            controls = new THREE.DeviceOrientationControls( camera );

            scene = new THREE.Scene();

            var geometry = new THREE.SphereBufferGeometry( 500, 128, 64 );
            geometry.scale( - 1.0, 1.0, 1.0 );
            var colorsForLayersLandscape = new THREE.TextureLoader().load( 'Test3Plans.jpg' );
            colorsForLayersLandscape.magFilter = THREE.LinearFilter;
            colorsForLayersLandscape.minFilter = THREE.LinearFilter;
            var material = new THREE.MeshBasicMaterial( {
                  // map: new THREE.TextureLoader().load( 'Test_01.jpg' )
                  //color: 0xff00ff,
                  map: colorsForLayersLandscape,
            } );

            var mesh = new THREE.Mesh( geometry, material );
            scene.add( mesh );


            var planeGroup = new THREE.Object3D();

            var plane;
            var loader = new THREE.JSONLoader();
            loader.load( 'PlaneLowPoly.json', function( geometry, materials ) {
                // var material = new THREE.MeshBasicMaterial( { color: 0xff00ff, side: THREE.BackSide, wireframe: true } );
                // var material = materials[ 0 ];
                plane = new THREE.Mesh( geometry, materials );

                //mesh.position.z = -50;

                plane.castShadow = true;
                plane.receiveShadow = true;

                planeGroup.add( plane );

                mixer.clipAction( geometry.animations[ 0 ], plane )
								     .setDuration( 1 )			// one second
								     .startAt( - Math.random() )	// random phase (already running)
                     .play();					// let's go
            } );

            // var plane;
            // var loader = new THREE.JSONLoader();
            // loader.load( 'PlaneLowPoly_Scene.json', function( planeObj ) {
            //     // var material = new THREE.MeshBasicMaterial( { color: 0xff00ff, side: THREE.BackSide, wireframe: true } );
            //     // var material = materials[ 0 ];
            //     var wingbottom = planeObj.getObjectByName("WingBottom");
            //     var wingtop = planeObj.getObjectByName("Wingtop");
            //
            //
            //     //mesh.position.z = -50;
            //
            //     planeObj.castShadow = true;
            //     planeObj.receiveShadow = true;
            //
            //     planeGroup.add( wingbottom );
            //     planeGroup.add( wingtop );
            //
            //
            // } );

            var helice;
            loader.load( 'Helice.json', function( geometry, materials ) {
                //side: THREE.BackSide
                // var material = materials[ 0 ];
                helice = new THREE.Mesh( geometry, materials );

                //mesh.position.z = -50;

                helice.castShadow = true;
                helice.receiveShadow = true;

                planeGroup.add( helice );

                geometry = new THREE.CircleBufferGeometry( 1.8, 16 );
                material = new THREE.MeshBasicMaterial( { color: 0x008855, transparent: true, opacity: 0.25, side: THREE.DoubleSide, wireframe: false } );
                var circle = new THREE.Mesh( geometry, material );

                circle.position.x = +3.6;
                circle.rotation.y = Math.PI/2;

                planeGroup.add( circle );


            } );
            planeGroup.scale.set(9, 9, 9);
            scene.add( planeGroup );

            var geometry = new THREE.BoxBufferGeometry( 100, 100, 100, 3, 3, 3 );
            var material = new THREE.MeshBasicMaterial( { color: 0xff00ff, transparent: true, opacity: 0.05, side: THREE.BackSide, wireframe: true } );
            var mesh = new THREE.Mesh( geometry, material );
            scene.add( mesh );

            // LIGHTS

            var ambientLight = new THREE.AmbientLight( 0xaaaacc );
            scene.add( ambientLight );

            //

            hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6 );
            hemiLight.color.setHSL( 0.6, 1, 0.6 );
            hemiLight.groundColor.setHSL( 0, 0.5, 0.8 );
            hemiLight.position.set( 0, 500, 0 );
            scene.add( hemiLight );

            //

            dirLight = new THREE.DirectionalLight( 0xffffff, 1 );
            dirLight.color.setHSL( 0.1, 1, 0.95 );
            dirLight.position.set( -1, 1.75, 1 );
            dirLight.position.multiplyScalar( 50 );
            scene.add( dirLight );

            dirLight.castShadow = true;

            dirLight.shadow.mapSize.width = 512;
            dirLight.shadow.mapSize.height = 512;

            var d = 250;

            dirLight.shadow.camera.left = -d;
            dirLight.shadow.camera.right = d;
            dirLight.shadow.camera.top = d;
            dirLight.shadow.camera.bottom = -d;

            dirLight.shadow.camera.near = -500;
            dirLight.shadow.camera.far = 1500;
            dirLight.shadow.bias = -0.0001;





            // RENDERER

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = 'absolute';
            renderer.domElement.style.top = 0;
            container.appendChild(renderer.domElement);

            renderer.shadowMap.enabled = true;
            renderer.shadowMap.renderReverseSided = false;

            window.addEventListener('resize', function() {

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );

            }, false);

            var animate = function(){

                stats.begin();

                window.requestAnimationFrame( animate );

                controls.update();



                if (plane != null && helice != null) {
                    planeGroup.rotation.x   += 0.01;
                    planeGroup.rotation.y   += 0.002;
                    helice.rotation.x   += 1.5;
                }

                renderer.render(scene, camera);

                stats.end();

            };

            window.requestAnimationFrame( animate );

    	}, false);

	})();
  </script>
</body>
</html>
